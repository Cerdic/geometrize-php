PHP version of https://github.com/Tw1ddle/geometrize-haxe/commit/e6ed1ab8c3867ac0da5bfea25ee4e7204ad286be
Based on PHP code generated with Haxe on this base version
+ manual optimization&refactoring